import{r,j as e,b as I,H as L,a as M,L as W}from"./app-CCuBXyND.js";function P({onDismiss:c}){const[o,d]=r.useState(null),[n,a]=r.useState(!1),[m,f]=r.useState(!1);r.useEffect(()=>{const t=/iPad|iPhone|iPod/.test(navigator.userAgent);a(t);const l=window.matchMedia("(display-mode: standalone)").matches;f(l),console.log("PWA Device Info:",{iOS:t,standalone:l});const p=g=>{console.log("beforeinstallprompt fired"),g.preventDefault(),d(g)};return window.addEventListener("beforeinstallprompt",p),()=>{window.removeEventListener("beforeinstallprompt",p)}},[]);const u=async()=>{if(o){o.prompt();const{outcome:t}=await o.userChoice;console.log("Install prompt result:",t),t==="accepted"&&(d(null),c&&c())}},x=()=>{sessionStorage.setItem("pwa-install-dismissed","true"),c&&c()};return sessionStorage.getItem("pwa-install-dismissed")==="true"||m?null:e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl max-w-md w-full p-6 relative",children:[e.jsx("button",{onClick:x,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-r from-purple-500 to-pink-500 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg",children:e.jsx("img",{src:"/images/logo.png",alt:"marcetime",className:"w-full h-full object-cover rounded-2xl"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"تثبيت marcetime"}),e.jsx("p",{className:"text-gray-600",children:"احصل على تجربة أفضل مع التطبيق المثبت"})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("span",{className:"text-gray-700",children:"وصول سريع من الشاشة الرئيسية"})]}),e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})}),e.jsx("span",{className:"text-gray-700",children:"أداء أسرع وأكثر سلاسة"})]}),e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-5 5v-5zM9 17H4l5 5v-5z"})})}),e.jsx("span",{className:"text-gray-700",children:"يعمل بدون إنترنت"})]})]}),n?e.jsxs("div",{className:"bg-blue-50 rounded-2xl p-4 mb-6",children:[e.jsx("h3",{className:"font-semibold text-blue-800 mb-2",children:"طريقة التثبيت على iPhone:"}),e.jsxs("div",{className:"space-y-2 text-sm text-blue-700",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("span",{children:"1."}),e.jsx("span",{children:"اضغط على أيقونة المشاركة"}),e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"})})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("span",{children:"2."}),e.jsx("span",{children:'اختر "إضافة إلى الشاشة الرئيسية"'})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("span",{children:"3."}),e.jsx("span",{children:'اضغط "إضافة"'})]})]})]}):e.jsx("button",{onClick:u,className:"w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white py-4 px-6 rounded-2xl font-semibold transition-all duration-300 shadow-lg hover:shadow-xl",children:"تثبيت التطبيق الآن"}),!n&&e.jsx("button",{onClick:x,className:"w-full mt-3 text-gray-500 hover:text-gray-700 py-2 px-4 rounded-xl transition-colors",children:"ربما لاحقاً"})]})})}function C(){const[c,o]=r.useState(!1),[d,n]=r.useState(!1),[a,m]=r.useState(null);return r.useEffect(()=>{"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(t=>{console.log("SW registered: ",t)}).catch(t=>{console.log("SW registration failed: ",t)})}),(()=>{const t=window.matchMedia("(display-mode: standalone)").matches,p=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&t;n(t||p)})();const x=t=>{t.preventDefault(),m(t),o(!0)};return window.addEventListener("beforeinstallprompt",x),window.addEventListener("appinstalled",()=>{n(!0),o(!1),m(null),console.log("PWA was installed")}),()=>{window.removeEventListener("beforeinstallprompt",x)}},[]),{isInstallable:c,isInstalled:d,installPWA:async()=>{if(a){a.prompt();const{outcome:u}=await a.userChoice;console.log(u==="accepted"?"User accepted the install prompt":"User dismissed the install prompt"),m(null),o(!1)}}}}function A({children:c,title:o="marcetime - نظام إدارة المخزون"}){const[d,n]=r.useState(!1),[a,m]=r.useState(!1),[f,u]=r.useState(new Date),[x,t]=r.useState(!1),{url:l,props:p}=I(),{isInstallable:g,isInstalled:b}=C(),i=p.auth?.user||null;r.useEffect(()=>{const s=()=>{const h=window.innerWidth<768;if(m(h),h){const w=localStorage.getItem("mobile-sidebar-open");n(w==="true")}else n(!0)};return s(),window.addEventListener("resize",s),()=>{window.removeEventListener("resize",s)}},[]),r.useEffect(()=>{const s=setInterval(()=>u(new Date),1e3);return()=>clearInterval(s)},[]),r.useEffect(()=>{if(i&&!b){const s=sessionStorage.getItem("pwa-prompt-shown"),h=sessionStorage.getItem("pwa-install-dismissed");if(console.log("PWA Check:",{user:!!i,isInstalled:b,isInstallable:g,hasShownPrompt:s,hasDismissed:h}),!s&&!h){const w=setTimeout(()=>{console.log("Showing PWA prompt"),t(!0),sessionStorage.setItem("pwa-prompt-shown","true")},2e3);return()=>clearTimeout(w)}}},[i,g,b]);const N=()=>{sessionStorage.removeItem("pwa-prompt-shown"),sessionStorage.removeItem("pwa-install-dismissed"),t(!0)},j=[{name:"الرئيسية",href:"/dashboard",icon:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z",description:"لوحة المراقبة الرئيسية"},{name:"إدارة المنتجات",href:"/products",icon:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4",description:"إدارة المخزون والمنتجات"},{name:"نقطة البيع",href:"/pos",icon:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z",description:"نقطة البيع والمبيعات"},{name:"إدارة الديون",href:"/debts",icon:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z",description:"متابعة الديون والدفعات"},{name:"التقارير",href:"/reports",icon:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z",description:"تقارير الأرباح والمبيعات"},{name:"الأرصدة",href:"/balance",icon:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z",description:"إدارة الأرصدة والسحوبات"},{name:"الإعدادات",href:"/settings",icon:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z M15 12a3 3 0 11-6 0 3 3 0 016 0z",description:"إعدادات النظام"}],k=()=>{if(a){const s=!d;n(s),localStorage.setItem("mobile-sidebar-open",s.toString())}},v=()=>j.find(h=>l.startsWith(h.href))||j[0],y=s=>s.toLocaleTimeString("ar-SA",{hour12:!1,hour:"2-digit",minute:"2-digit"}),S=s=>s.toLocaleDateString("ar-SA",{weekday:"long",year:"numeric",month:"long",day:"numeric"});return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsxs(L,{title:`${o} - ${i?.name||"marcetime"}`,children:[e.jsx("link",{rel:"icon",type:"image/png",href:"/images/logo.png"}),e.jsx("meta",{name:"description",content:"نظام إدارة المخزون والأرباح - marcetime"})]}),e.jsx("header",{className:"bg-white border-b border-gray-200 shadow-sm backdrop-blur-md bg-opacity-95 sticky top-0 z-50",children:e.jsx("div",{className:"px-3 sm:px-4 md:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-12 sm:h-14",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3 md:space-x-4 space-x-reverse",children:[a&&e.jsx("button",{onClick:k,className:"p-1.5 sm:p-2 rounded-lg text-gray-500 hover:text-gray-700 hover:bg-gray-100 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-20",children:e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 6h16M4 12h16M4 18h16"})})}),e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3 space-x-reverse",children:[e.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-white rounded-xl flex items-center justify-center shadow-lg border-2 border-gray-100 backdrop-blur-sm overflow-hidden",children:e.jsx("img",{src:"/images/logo.png",alt:"marcetime logo",className:"w-full h-full object-cover rounded-xl"})}),e.jsxs("div",{className:"hidden xs:block sm:block",children:[e.jsxs("h1",{className:"text-xs sm:text-sm font-semibold text-gray-900",children:["marcetime - ",i?.name||"إدارة النظام"]}),e.jsx("p",{className:"text-xs text-gray-500 hidden sm:block",children:v().name})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-1 sm:space-x-2 md:space-x-3 space-x-reverse",children:[e.jsxs("div",{className:"hidden md:block text-right",children:[e.jsx("p",{className:"text-xs font-medium text-gray-900",children:y(f)}),e.jsx("p",{className:"text-xs text-gray-500",children:S(f).split("،")[0]})]}),e.jsxs("div",{className:"flex items-center space-x-1 sm:space-x-2 space-x-reverse",children:[e.jsxs("div",{className:"hidden lg:block text-right",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-900",children:i?.name||"مستخدم النظام"}),e.jsx("p",{className:"text-xs text-gray-500",children:i?.role==="manager"?"مدير النظام":"شريك"})]}),e.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-gradient-to-br from-green-400 to-blue-500 rounded-full flex items-center justify-center text-white text-xs sm:text-sm font-semibold",children:i?.name?i.name.charAt(0):"م"})]}),e.jsx("button",{onClick:()=>{confirm("هل تريد تسجيل الخروج؟")&&M.post("/logout")},className:"p-1.5 sm:p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-20",title:"خروج",children:e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})}),e.jsx("button",{onClick:N,className:"p-1.5 sm:p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-20",title:"اختبار PWA",children:e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"})})})]})]})})}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[a&&d&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-30",onClick:()=>{n(!1),localStorage.setItem("mobile-sidebar-open","false")}}),e.jsx("aside",{className:`
                    ${a?"fixed":"relative"}
                    ${a?d?"translate-x-0":"-translate-x-full":"translate-x-0"}
                    z-40 w-full sm:w-80 md:w-72 lg:w-64 bg-white border-r border-gray-200 shadow-2xl lg:shadow-none transition-transform duration-300 ease-in-out
                `,style:{height:a?"100vh":"calc(100vh - 56px)"},children:e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsx("div",{className:"p-3 sm:p-4 border-b border-gray-100 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3 space-x-reverse",children:[e.jsx("div",{className:"w-7 h-7 sm:w-8 sm:h-8 bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl flex items-center justify-center border-2 border-blue-200 shadow-lg backdrop-blur-sm overflow-hidden",children:e.jsx("img",{src:"/images/logo.png",alt:"marcetime logo",className:"w-full h-full object-cover rounded-xl"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm sm:text-sm font-semibold text-gray-900",children:"marcetime"}),e.jsx("p",{className:"text-xs text-gray-500",children:"نظام إدارة المخزون"})]})]}),a&&e.jsx("button",{onClick:()=>{n(!1),localStorage.setItem("mobile-sidebar-open","false")},className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-all duration-200",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:e.jsx("nav",{className:"px-2 sm:px-3 py-3 sm:py-4 space-y-1.5 sm:space-y-2",children:j.map(s=>e.jsxs(W,{href:s.href,onClick:()=>{a&&(n(!1),localStorage.setItem("mobile-sidebar-open","false"))},className:`w-full flex items-center px-3 sm:px-4 py-3.5 sm:py-4 md:py-2.5 text-right rounded-xl transition-all duration-200 group ${l.startsWith(s.href)?"bg-blue-50 text-blue-700 shadow-sm border-r-2 border-blue-500":"text-gray-600 hover:bg-gray-50 hover:text-gray-900 active:bg-gray-100"}`,children:[e.jsx("svg",{className:`ml-2.5 sm:ml-3 w-5 h-5 sm:w-6 sm:h-6 md:w-5 md:h-5 ${l.startsWith(s.href)?"text-blue-600":"text-gray-400 group-hover:text-gray-600"} transition-colors duration-200`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:s.icon})}),e.jsxs("div",{className:"flex-1 text-right",children:[e.jsx("div",{className:`text-sm sm:text-base md:text-sm font-medium ${l.startsWith(s.href)?"text-blue-900":""}`,children:s.name}),e.jsx("div",{className:`text-xs sm:text-sm md:text-xs mt-0.5 sm:mt-1 md:mt-0.5 ${l.startsWith(s.href)?"text-blue-600":"text-gray-500"}`,children:s.description})]}),l.startsWith(s.href)&&e.jsx("div",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 md:w-2 md:h-2 bg-blue-500 rounded-full"})]},s.name))})}),e.jsx("div",{className:"p-3 sm:p-4 border-t border-gray-100 flex-shrink-0 bg-white",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-2.5 sm:p-3 border border-blue-100",children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx("div",{className:"w-5 h-5 sm:w-6 sm:h-6 bg-blue-500 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium text-blue-900 truncate",children:"النسخة المتطورة"}),e.jsx("p",{className:"text-xs text-blue-600 truncate",children:"جميع الميزات متاحة"})]})]})})})]})}),e.jsx("main",{className:"flex-1 overflow-hidden",children:e.jsx("div",{className:"h-full overflow-y-auto",children:e.jsxs("div",{className:"p-3 sm:p-4 md:p-6 lg:p-8",children:[e.jsx("div",{className:"mb-4 md:mb-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"w-8 h-8 md:w-10 md:h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx("svg",{className:"w-4 h-4 md:w-5 md:h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:v().icon})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg md:text-xl font-bold text-gray-900",children:v().name}),e.jsx("p",{className:"text-xs md:text-sm text-gray-500 hidden sm:block",children:v().description})]})]})})}),e.jsx("div",{className:"bg-white rounded-lg md:rounded-xl shadow-sm border border-gray-200 min-h-[calc(100vh-180px)] md:min-h-[calc(100vh-200px)]",children:e.jsx("div",{className:"p-4 sm:p-6",children:c})})]})})})]}),x&&e.jsx(P,{onDismiss:()=>t(!1)})]})}export{A};
