import{r as i,u as B,j as e,H as W}from"./app-BsVf6_Q7.js";import{A as D}from"./AppLayout-CpyaWvdG.js";function H({products:v=[],auth:c}){const[a,x]=i.useState(null),[w,u]=i.useState(!1),[f,_]=i.useState(""),[h,k]=i.useState(v),[L,p]=i.useState(!1),[r,g]=i.useState(null),{data:t,setData:l,post:q,processing:b,errors:N,reset:T}=B({product_id:"",user_id:c.user.id,quantity_sold:1,payment_type:"cash",customer_name:""}),o=s=>new Intl.NumberFormat("ar-IQ",{style:"currency",currency:"IQD",minimumFractionDigits:0}).format(s),S=s=>{x(s),l({...t,product_id:s.id,user_id:c.user.id,quantity_sold:1}),u(!0)},C=s=>{if(s.preventDefault(),console.log("بدء عملية البيع..."),console.log("البيانات:",t),console.log("المنتج المختار:",a),!a||!t.quantity_sold||t.quantity_sold<1){alert("يرجى التأكد من صحة البيانات");return}if(t.payment_type==="debt"&&!t.customer_name.trim()){alert("يرجى إدخال اسم العميل للبيع بالأجل");return}const d={product_id:t.product_id,user_id:t.user_id,quantity_sold:t.quantity_sold,payment_type:t.payment_type,customer_name:t.payment_type==="debt"?t.customer_name:""};console.log("البيانات المرسلة:",d),q(route("sales.store"),d,{onSuccess:n=>{console.log("البيع تم بنجاح:",n),g({productName:a.name,quantity:t.quantity_sold,total:a.selling_price*t.quantity_sold,paymentType:t.payment_type==="cash"?"نقدي":"أجل",customerName:t.customer_name}),p(!0),k(j=>j.map(m=>m.id===a.id?{...m,quantity:m.quantity-t.quantity_sold}:m)),l({product_id:"",user_id:c.user.id,quantity_sold:1,payment_type:"cash",customer_name:""}),setTimeout(()=>{p(!1),g(null)},4e3)},onError:n=>{console.error("خطأ في البيع:",n),alert("حدث خطأ أثناء البيع: "+JSON.stringify(n))},onFinish:()=>{console.log("انتهت العملية - إغلاق النافذة"),u(!1),x(null)}})},M=()=>{if(!a)return{cost:0,revenue:0,profit:0};const s=t.quantity_sold||1,d=(a.purchase_price+a.marketing_cost)*s,n=a.selling_price*s,j=n-d;return{cost:d,revenue:n,profit:j}},{cost:P,revenue:z,profit:F}=M(),y=h.filter(s=>s.name.toLowerCase().includes(f.toLowerCase()));return e.jsxs(D,{children:[e.jsx(W,{title:"نقطة البيع"}),e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-100",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx("svg",{className:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"نقطة البيع"})]}),e.jsxs("div",{className:"hidden md:flex items-center gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-blue-600",children:h.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"منتج"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:h.filter(s=>s.quantity>0).length}),e.jsx("div",{className:"text-xs text-gray-500",children:"متوفر"})]})]})]})})}),e.jsx("div",{className:"bg-white px-4 py-3 border-b border-gray-100",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"البحث عن منتج...",value:f,onChange:s=>_(s.target.value),className:"w-full pr-10 pl-4 py-3 bg-gray-100 border-0 rounded-xl text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white"})]})})}),e.jsx("div",{className:"px-4 py-3",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsxs("p",{className:"text-gray-600 text-sm",children:["تم العثور على ",y.length," منتج"]})})}),e.jsx("div",{className:"px-4 pb-8",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:y.length>0?y.map(s=>e.jsxs("div",{onClick:()=>S(s),className:"bg-white rounded-2xl overflow-hidden shadow-sm hover:shadow-md transition-shadow duration-200 cursor-pointer relative",children:[e.jsx("button",{className:"absolute top-3 left-3 p-1.5 z-10",children:e.jsx("svg",{className:"w-5 h-5 text-gray-300 hover:text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})})}),e.jsx("div",{className:"aspect-square bg-gray-100 overflow-hidden",children:s.image?e.jsx("img",{src:s.image,alt:s.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("svg",{className:"w-12 h-12 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})})}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 text-sm mb-1 line-clamp-2",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4 text-orange-400",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}),e.jsx("span",{className:"text-xs text-gray-600",children:"4.8"})]}),e.jsx("span",{className:"text-gray-300",children:"•"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{className:"text-xs text-gray-600",children:[s.quantity," قطعة"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-lg font-bold text-gray-900",children:o(s.selling_price)}),s.quantity===0&&e.jsx("span",{className:"text-xs text-red-500 font-medium",children:"نفد المخزون"})]})]})]},s.id)):e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx("div",{className:"text-gray-400 mb-4",children:e.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"لا توجد نتائج"}),e.jsx("p",{className:"text-gray-500",children:"جرب البحث بكلمات أخرى"})]})})})})]}),w&&a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-end sm:items-center justify-center z-50",children:e.jsx("div",{className:"bg-white w-full sm:max-w-md sm:mx-4 rounded-t-3xl sm:rounded-3xl shadow-2xl",children:e.jsxs("form",{onSubmit:C,children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"بيع المنتج"}),e.jsx("button",{type:"button",onClick:()=>{u(!1),x(null),l({product_id:"",user_id:c.user.id,quantity_sold:1,payment_type:"cash",customer_name:""})},className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx("svg",{className:"w-6 h-6 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:a.name}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["السعر: ",o(a.selling_price)]}),e.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:["البائع: ",c.user.name]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"الكمية"}),e.jsx("input",{type:"number",min:"1",max:a.quantity,value:t.quantity_sold,onChange:s=>l("quantity_sold",parseInt(s.target.value)),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["متوفر: ",a.quantity," قطعة"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"طريقة الدفع"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("button",{type:"button",onClick:()=>l("payment_type","cash"),className:`py-3 px-4 rounded-xl font-medium transition-colors ${t.payment_type==="cash"?"bg-green-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"نقدي"}),e.jsx("button",{type:"button",onClick:()=>l("payment_type","debt"),className:`py-3 px-4 rounded-xl font-medium transition-colors ${t.payment_type==="debt"?"bg-orange-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"أجل"})]})]}),t.payment_type==="debt"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"اسم العميل"}),e.jsx("input",{type:"text",value:t.customer_name,onChange:s=>l("customer_name",s.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent",placeholder:"أدخل اسم العميل...",required:!0}),N.customer_name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:N.customer_name})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl",children:[e.jsx("h5",{className:"font-medium text-gray-900 mb-3",children:"ملخص العملية"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"السعر للوحدة:"}),e.jsx("span",{className:"font-medium",children:o(a.selling_price)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"الكمية:"}),e.jsx("span",{className:"font-medium",children:t.quantity_sold})]}),e.jsxs("div",{className:"flex justify-between border-t border-gray-200 pt-2",children:[e.jsx("span",{className:"text-blue-600 font-medium",children:"المبلغ الإجمالي:"}),e.jsx("span",{className:"font-bold text-blue-600",children:o(z)})]})]})]})]}),e.jsx("div",{className:"p-6 border-t border-gray-100",children:e.jsx("button",{type:"submit",disabled:b,className:"w-full py-4 bg-blue-500 hover:bg-blue-600 text-white rounded-xl font-medium transition-colors disabled:opacity-50",children:b?"جاري البيع...":"تأكيد البيع"})})]})})}),L&&r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-3xl max-w-sm w-full mx-4 shadow-2xl transform animate-bounce",children:e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full mx-auto mb-4 flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"تم البيع بنجاح!"}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 mb-6",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"المنتج:"})," ",r.productName]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"الكمية:"})," ",r.quantity]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"المبلغ:"})," ",o(r.total)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"الدفع:"})," ",r.paymentType]}),r.paymentType==="أجل"&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"العميل:"})," ",r.customerName]})]}),e.jsx("button",{onClick:()=>{p(!1),g(null)},className:"w-full py-3 bg-green-600 hover:bg-green-700 text-white rounded-xl font-medium transition-colors",children:"موافق"}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"أو سيتم الإغلاق تلقائياً خلال 4 ثواني"})]})})})]})}export{H as default};
